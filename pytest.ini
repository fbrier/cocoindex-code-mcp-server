# This file is part of cocoindex_code_mcp_server from
# https://github.com/aanno/cocoindex-code-mcp-server
#
# Copyright (C) 2025 aanno <aanno@users.noreply.github.com>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program. If not, see <https://www.gnu.org/licenses/>.

[pytest]
minversion = 6.0
# addopts = -ra -q --strict-markers -m "not mcp_integration"
addopts = -ra -q --strict-markers
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
# https://stackoverflow.com/questions/4673373/logging-within-pytest-tests
log_cli = 1
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_cli_date_format=%Y-%m-%d %H:%M:%S

markers =
    # Hybrid Search markers
    hybrid_search: Tests for hybrid search functionality
    keyword_parser: Tests for keyword search parser
    search_engine: Tests for hybrid search engine
    backend: Tests for vector store backend functionality
    integration: Integration tests
    unit: Unit tests

    # Existing functionality markers
    ast_chunking: Tests for AST chunking functionality
    haskell: Tests for Haskell language support
    live_updates: Tests for live update functionality
    cli: Tests for command-line interface
    embedding: Tests for embedding functionality
    chunking: Tests for code chunking

    # Test categories
    slow: Tests that take longer to run
    external: Tests that require external dependencies
    standalone: Tests that can run independently
    db_integration: Tests that require database integration
    mcp_integration: Tests that require MCP integration
    cocoindex_extension: Tests for cocoindex extension functionality
    timeout: Tests with custom timeouts

[mypy]
check_untyped_defs = true
ignore_missing_imports = false
local_partial_types = false
