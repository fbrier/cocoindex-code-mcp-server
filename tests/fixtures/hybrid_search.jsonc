{
  "tests": [
    {
      "name": "basename_python_language_filter",
      "description": "Search for 'basename' with Python language filter - should find files with proper metadata",
      "query": {
        "vector_query": "basename",
        "keyword_query": "language:Python",
        "language": "Python"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "complexity_score": ">0",
              "has_classes": true,
              "analysis_method": "!unknown"
            },
            "should_not_be_empty": [
              "code"
            ]
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "ast_visitor_search",
      "description": "Search for AST visitor related code",
      "query": {
        "vector_query": "AST visitor pattern",
        "keyword_query": "language:Python",
        "language": "Python"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "python_handler_search",
      "description": "Search for Python functions and classes",
      "query": {
        "vector_query": "python handler",
        "keyword_query": "language:Python",
        "language": "Python"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "has_classes": true,
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "complex_function_search",
      "description": "Search for complex functions with high complexity",
      "query": {
        "vector_query": "complex algorithm implementation",
        "keyword_query": "language:Python",
        "language": "Python"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "complexity_score": ">1",
              "functions": "!empty",
              "code": "!empty",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "class_search",
      "description": "Search for files containing classes",
      "query": {
        "vector_query": "class definition",
        "keyword_query": "language:Python has_classes:true",
        "language": "Python"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "classes": "!empty",
              "has_classes": true,
              "code": "!empty",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 2
      }
    },
    {
      "name": "rust_struct_search",
      "description": "Search for Rust struct definitions and implementations",
      "query": {
        "vector_query": "struct implementation methods",
        "keyword_query": "language:Rust",
        "language": "Rust"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?rust_example_1\\.rs$",
            "expected_metadata": {
              "functions": "!empty",
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "java_class_inheritance_search",
      "description": "Search for Java class inheritance and polymorphism",
      "query": {
        "vector_query": "class inheritance abstract extends",
        "keyword_query": "language:Java",
        "language": "Java"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?java_example_1\\.java$",
            "expected_metadata": {
              "classes": "!empty",
              "functions": "!empty",
              "has_classes": true,
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "java_package_structure_search",
      "description": "Search for Java files with package structure and generics",
      "query": {
        "vector_query": "package structure generics abstract class",
        "keyword_query": "language:Java",
        "language": "Java"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?.*Main1\\.java$",
            "expected_metadata": {
              "classes": "!empty",
              "functions": "!empty",
              "has_classes": true,
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "javascript_arrow_functions_search",
      "description": "Search for JavaScript arrow functions and closures",
      "query": {
        "vector_query": "arrow function closure callback",
        "keyword_query": "language:JavaScript",
        "language": "Javascript"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?javascript_example_1\\.js$",
            "expected_metadata": {
              "language": "JavaScript"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "typescript_interface_search",
      "description": "Search for TypeScript interfaces and type definitions",
      "query": {
        "vector_query": "interface type definition generics",
        "keyword_query": "language:TypeScript",
        "language": "Typescript"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?typescript_example_1\\.ts$",
            "expected_metadata": {
              "functions": "!empty",
              "has_type_hints": true,
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "cpp_template_search",
      "description": "Search for C++ templates and generic programming",
      "query": {
        "vector_query": "template generic class function",
        "keyword_query": "language:C++",
        "language": "C"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?cpp_example_1\\.cpp$",
            "expected_metadata": {
              "functions": "!empty",
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "c_struct_functions_search",
      "description": "Search for C struct definitions and functions",
      "query": {
        "vector_query": "struct typedef function pointer",
        "keyword_query": "language:C",
        "language": "C"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?c_example_1\\.c$",
            "expected_metadata": {
              "functions": "!empty",
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "kotlin_data_class_search",
      "description": "Search for Kotlin data classes and sealed classes",
      "query": {
        "vector_query": "data class sealed class when expression",
        "keyword_query": "language:Kotlin",
        "language": "Kotlin"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?kotlin_example_1\\.kt$",
            "expected_metadata": {
              "functions": "!empty",
              "classes": "!empty",
              "has_classes": true,
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "haskell_functional_search",
      "description": "Search for Haskell functional programming patterns",
      "query": {
        "vector_query": "higher order function pattern matching recursion",
        "keyword_query": "language:Haskell",
        "language": "Haskell"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?HaskellExample1\\.hs$",
            "expected_metadata": {
              "functions": "!empty",
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "multi_language_fibonacci_search",
      "description": "Search for fibonacci implementations across all languages",
      "fail_expected": true,
      "fail_reason": "Cross-language semantic search not supported with smart embeddings - each language uses a different embedding model, so no single query vector can match across all models",
      "query": {
        "vector_query": "fibonacci recursive algorithm implementation",
        "keyword_query": "functions:fibonacci"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "functions": "!empty",
              "complexity_score": ">0",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 2
      }
    },
    {
      "name": "cross_language_class_search",
      "description": "Search for class definitions across object-oriented languages",
      "fail_expected": true,
      "fail_reason": "Cross-language semantic search not supported with smart embeddings - each language uses a different embedding model",
      "query": {
        "vector_query": "class constructor method inheritance",
        "keyword_query": "has_classes:true"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "classes": "!empty",
              "functions": "!empty",
              "has_classes": true,
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 2
      }
    },
    {
      "name": "promoted_metadata_fields_validation",
      "description": "Validate that promoted metadata fields are properly populated",
      "query": {
        "vector_query": "python class functions",
        "keyword_query": "language:Python has_classes:true",
        "language": "Python"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "analysis_method": "!unknown",
              "chunking_method": "ast_tree_sitter",
              "has_classes": true
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "hybrid_intersection_fibonacci_java_only",
      "description": "HYBRID TEST: Vector finds fibonacci in all languages, keyword filters to Java only (intersection)",
      "query": {
        "vector_query": "recursive fibonacci sequence algorithm implementation",
        "keyword_query": "language:Java",
        "language": "Java"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*java_example.*\\.java$",
            "expected_metadata": {
              "language": "Java",
              "functions": "!empty"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "hybrid_intersection_complex_python_only",
      "description": "HYBRID TEST: Semantic search for complex algorithms restricted to Python files only",
      "fail_expected": true,
      "fail_reason": "Test validation too strict - expects ALL Python chunks to have non-empty functions, but some chunks contain only classes/imports",
      "query": {
        "vector_query": "complex recursive algorithm data structure implementation",
        "keyword_query": "language:Python",
        "language": "Python"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "language": "Python",
              "functions": "!empty",
              "analysis_method": "!unknown"
            }
          }
        ],
        "min_results": 1
      }
    },
    {
      "name": "hybrid_intersection_class_based_languages",
      "description": "HYBRID TEST: Find class-based OOP patterns but only in languages with explicit classes",
      "fail_expected": true,
      "fail_reason": "Cross-language semantic search not supported with smart embeddings - each language uses a different embedding model",
      "query": {
        "vector_query": "class definition constructor methods object oriented",
        "keyword_query": "has_classes:true"
      },
      "expected_results": {
        "should_contain": [
          {
            "expected_metadata": {
              "has_classes": true,
              "classes": "!empty",
              "functions": "!empty"
            }
          }
        ],
        "min_results": 2
      }
    },
    {
      "name": "hybrid_semantic_ranking_within_filter",
      "description": "HYBRID TEST: Among Rust files, rank by semantic similarity to 'struct implementation'",
      "query": {
        "vector_query": "struct implementation methods traits impl",
        "keyword_query": "language:Rust",
        "language": "Rust"
      },
      "expected_results": {
        "should_contain": [
          {
            "filename_pattern": ".*(tmp/)?rust_example.*\\.rs$",
            "expected_metadata": {
              "language": "Rust",
              "functions": "!empty"
            }
          }
        ],
        "min_results": 1
      }
    }
  ],
  "test_metadata": {
    "version": "2.1",
    "description": "Multi-language hybrid search integration tests to validate code analysis and hybrid search intersection behavior",
    "supported_languages": [
      "python",
      "rust",
      "java",
      "javascript",
      "typescript",
      "cpp",
      "c",
      "kotlin",
      "haskell"
    ],
    "test_categories": [
      "Language-specific searches (Python, Rust, Java, JS, TS, C++, C, Kotlin, Haskell)",
      "Cross-language pattern searches (fibonacci implementations, class definitions)",
      "Metadata validation (functions, classes, complexity, analysis methods)",
      "Hybrid search intersection behavior tests (vector + keyword combination)"
    ],
    "notes": [
      "Tests validate that files are properly analyzed with correct metadata across all languages",
      "Empty code fields indicate analysis failures",
      "analysis_method should not be 'unknown' for proper analysis",
      "Each language should use appropriate embedding models (GraphCodeBERT vs UniXcode vs fallback)",
      "Patterns use regex matching, ! prefix means 'not equal'",
      "> prefix means 'greater than' for numeric comparisons",
      "Cross-language tests verify consistent metadata extraction across different syntaxes",
      "HYBRID INTERSECTION TESTS: Verify that hybrid search applies keyword filters FIRST, then ranks by vector similarity",
      "Hybrid results should always be subset of keyword-filtered results (intersection behavior)",
      "Tests marked 'HYBRID TEST' specifically validate the intersection semantics of hybrid search"
    ]
  }
}
